<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EAGLE ZYBO Linux: Status Quaestionis</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EAGLE ZYBO Linux
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_Status-Quaestionis.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Status Quaestionis </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>ZYBO Linux</h2>
<p>For compiling C/C++ applications for the ZYBO core running Linux, a GNU Toolchain is used. This toolchain is available as a Docker image for maximum portability, because installing GCC etc. on Windows is not trivial.</p>
<p>The Docker image also contains a native x86-64 toolchain for testing and debugging. This allows you to run the applications not only on the ZYBO, but on any normal computer as well.</p>
<p>All build tasks are available as tasks in Visual Studio Code, this includes building the Docker images, toolchains, libraries, ZYBO applications, testing, debugging.</p>
<h3>Crypto</h3>
<p>‚úì I provided the basic structure for the Crypto code. It just writes a single word to R0, and then reads it back from R1.</p>
<p>‚úì I included the ZBar library for decoding the <a class="el" href="structQR.html">QR</a> code. I also tried the OpenCV <a class="el" href="structQR.html">QR</a> decoder, but ZBar seems to work better. I added a test as an example to run it asynchronously, that is, vision keeps on refreshing while the <a class="el" href="structQR.html">QR</a> decoder is running. It remains to be seen if this is a good idea, because we only have a single thread anyway.</p>
<p>‚úì I also added a base64-decoder library for extracting the binary data from the <a class="el" href="structQR.html">QR</a> code.</p>
<p>üóô The next step is to write functions that are able to decode strings of data, as well as more elaborate test cases.</p>
<p>The public API of the crypto code goes in <code>src/crypto/include/crypto.hpp</code>, and the implementations in <code>src/crypto/src/crypto.cpp</code>. <br  />
Test cases go in <code>src/crypto/test/test-crypto.cpp</code>.</p>
<p>üóô The reading and writing of the FPGA registers uses the provided code in <code><a class="el" href="wrapper_8c.html">src/comm/src/wrapper.c</a></code>, from <a href="https://www.xilinx.com/support/documentation/application_notes/xapp1078-amp-linux-bare-metal.pdf">Xilinx Application note 1078</a>. <br  />
This is not ideal, because it has a lot of overhead when reading large amounts of data. The code is simple enough, and adding a function for doing longer transactions to the FPGA is a good idea, instead of calling the <code><a class="el" href="wrapper_8h.html#a8efeb9db88385717fd8d78494188d11d">rmem()</a></code> and <code><a class="el" href="wrapper_8h.html#a33eaf162ba3d16c401a1f37349d81fe3">wmem()</a></code> functions for each word separately.</p>
<p>‚úì Tuur and Cyriel are working on the code that reads and decodes the <a class="el" href="structQR.html">QR</a> code, and sends the data to crypto.</p>
<h3>Logging</h3>
<p>The logging on the Linux side is pretty basic: it just reads the size of the log entry from shared memory (<code><a class="el" href="wrapper_8h.html">wrapper.h</a></code>), and then reads this many words and sends them as a multicast UDP packet.</p>
<p>‚úì The multicast sender has been implemented and tested.</p>
<p>üóô The part that reads from shared memory is trivial, but not finished yet, we'll have to finish the logger in Baremetal first. <br  />
It's important that we use different locks for logging and vision.</p>
<p>üóô If we can't get multicast routing to work for the base station, we might have to send the same message as unicast as well.</p>
<h3>Vision</h3>
<p>‚úì The main part of the vision algorithm is <a class="el" href="classGridFinder.html" title="A class for finding the lines and intersections in an image of a grid.">GridFinder</a>: as an input, it uses the mask, where red lines are white, and everything else is black. As an output, it returns the vertices of the square of the grid in the center of the frame, and the lines (and angles) of that square. <br  />
This part is finished, and has been tested using videos.</p>
<p>‚úì I've completely re-written the red pixel detection for generating the masks. <br  />
It now uses ARM <a class="el" href="namespaceNEON.html">NEON</a> SIMD vector instructions, so it can mask 16 pixels in parallel. There's also a function that's a bit more accurate, but a bit slower. If dark, washed-out red is detected as a line, and if this is a problem, we could use that code instead.</p>
<p>‚úì Reading the image from the HDMI input seems to be working. There is a purple line at the edge of the frame though, that I can't seem to get rid of.</p>
<p>‚úì Getting the absolute position of the drone seems to be working. The entire vision program runs at 60 fps on the ZYBO, but every two frames are the same, because the camera only updates at 30 fps.</p>
<p>üóô Finally, this location has to be sent to the BareMetal core. This is trivial.</p>
<h2>ZYBO Baremetal</h2>
<h3>BaremetalImproved framework</h3>
<p>‚úì src-vivado is rewritten <br  />
üóô corrected functionality in src-vivado (e.g. IMU calibration, IMU reading, AHRS orientation, clamp RC inputs) needs to be verified <br  />
‚ùì src is nearly finished <br  />
üóô the entire framework needs to be debugged <br  />
 </p><h3>Controllers</h3>
<p>‚úì Controllers simulated <br  />
‚úì Code generator working <br  />
‚ùì Attitude is tuned, but needs fine tuning for new battery <br  />
‚ùì Altitude is tuned, but needs fine tuning for new battery <br  />
‚ùì Navigation controller needs tuning <br  />
üóô Observer for navigation that only uses the accelerometer measurements (for taking off/landing when there's no vision data)</p>
<h3>Autopilot</h3>
<p>‚ùì Autonomous navigation has been programmed, it will be tested as soon as we finish tuning the navigation controller <br  />
‚ùì Automatic take-off and landing has been implemented, but not tested yet</p>
<h3>Logger</h3>
<p>‚úì Code generator working <br  />
‚ùì Update code generator with new BaremetalImproved <br  />
 </p><h2>Videos for technical milestones T4</h2>
<h3>1. Flying</h3>
<p>‚úì Stable flight demonstrated for 10s <br  />
‚úì Pilot in control of flight moving left, right, forward, backward, up and down</p>
<h3>2. ESCs</h3>
<p>‚úì Demonstrate at least one working and integrated ESC. The pilot is able to control motor throttle via the remote controller. <br  />
üóô Flying with own ESCs</p>
<h3>3. Altitude controller</h3>
<p>‚úì Flying for 10s while only manually controlling X-Y <br  />
‚úì Dito, but with very stable achieved (&lt;30cm variation) at most 20 seconds after enabling height control and maintained for at least 20 seconds</p>
<h3>4. Loitering</h3>
<p>üóô Staying autonomously (more or less) within a 3x3 square grid without manual x-y control for 10s <br  />
üóô Long term (&gt;10s) stable location within a single square, proven by automatic landing within a square (on the coil)</p>
<h3>5. Wireless video link</h3>
<p>‚ùì Wireless video link established and link performance analysis done <br  />
üóô Wireless video link parameters tuned autonomously</p>
<h3>6. Logging</h3>
<p>‚ùì Real-time logging info during flight <br  />
üóô Very informative and visually attractive logging, graphically plotting info at real time during flight</p>
<h3>7. Navigation (walking)</h3>
<p>üóô Decode current X-Y coordinates in the grid at any square (also those without <a class="el" href="structQR.html">QR</a> code), and decode location targets from <a class="el" href="structQR.html">QR</a> codes while walking over the grid with drone, being correct over at least 10 squares and 2 <a class="el" href="structQR.html">QR</a> codes. Results should show up on GUI <br  />
üóô Do the same with a hardware accelerated crypto implementation</p>
<h3>8. Navigation (flying)</h3>
<p>üóô Real-time localization during actual flight <br  />
üóô Flying/navigating fully autonomously following the <a class="el" href="structQR.html">QR</a> trail of the mission</p>
<h3>9. WPT</h3>
<p>‚úì Capable of fully lighting up the LED wall after manually putting the drone on the coil, with on/off activation with the remote control. <br  />
‚úì Lighting up the LED wall even when the two coils are aligned only 50%, e.g. after automated landing. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
